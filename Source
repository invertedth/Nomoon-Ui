local NoMoonUI = {}
NoMoonUI.__index = NoMoonUI

-- Services
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.Name = "NoMoonUI"
ScreenGui.ResetOnSpawn = false

-- Theme Presets
local Themes = {
    Midnight = {Color3.fromRGB(30, 30, 50), Color3.fromRGB(50, 50, 80), Color3.fromRGB(100, 100, 120)},
    Ocean = {Color3.fromRGB(0, 105, 148), Color3.fromRGB(0, 160, 199), Color3.fromRGB(0, 210, 255)},
    Sunset = {Color3.fromRGB(255, 94, 77), Color3.fromRGB(255, 144, 104), Color3.fromRGB(255, 189, 136)},
}

-- Main Library
function NoMoonUI:CreateWindow(config)
    local window = {}
    window.Name = config.Name or "NoMoon UI"
    window.Subtitle = config.Subtitle or ""
    window.LogoID = config.LogoID or nil
    window.LoadingEnabled = config.LoadingEnabled or false
    window.LoadingTitle = config.LoadingTitle or "NoMoon UI"
    window.LoadingSubtitle = config.LoadingSubtitle or "by YourName"
    window.KeySystem = config.KeySystem or false
    window.KeySettings = config.KeySettings or {Title = "Key System", Subtitle = "", Note = "", FileName = "NoMoonKey", SaveKey = true, Key = {"ExampleKey"}}
    window.Theme = config.Theme or Themes.Midnight

    -- Main Frame
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 600, 0, 400)
    MainFrame.Position = UDim2.new(0.5, -300, 0.5, -200)
    MainFrame.BackgroundColor3 = window.Theme[1]
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui

    -- Title
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, 0, 0, 30)
    TitleLabel.Position = UDim2.new(0, 0, 0, 0)
    TitleLabel.BackgroundColor3 = window.Theme[2]
    TitleLabel.Text = window.Name .. (window.Subtitle ~= "" and " - " .. window.Subtitle or "")
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.Font = Enum.Font.SourceSansBold
    TitleLabel.TextSize = 20
    TitleLabel.Parent = MainFrame

    -- Draggable
    local dragging, dragInput, dragStart, startPos
    local function updateInput(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    TitleLabel.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    TitleLabel.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            updateInput(input)
        end
    end)

    -- Tabs Container
    local TabContainer = Instance.new("Frame")
    TabContainer.Size = UDim2.new(0, 150, 1, -30)
    TabContainer.Position = UDim2.new(0, 0, 0, 30)
    TabContainer.BackgroundColor3 = window.Theme[3]
    TabContainer.Parent = MainFrame

    local TabLayout = Instance.new("UIListLayout")
    TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabLayout.Parent = TabContainer

    -- Content Area
    local ContentArea = Instance.new("Frame")
    ContentArea.Size = UDim2.new(1, -150, 1, -30)
    ContentArea.Position = UDim2.new(0, 150, 0, 30)
    ContentArea.BackgroundTransparency = 1
    ContentArea.Parent = MainFrame

    window.Tabs = {}
    window.CurrentTab = nil

    -- Key System
    if window.KeySystem then
        local KeyFrame = Instance.new("Frame")
        KeyFrame.Size = UDim2.new(0, 300, 0, 200)
        KeyFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
        KeyFrame.BackgroundColor3 = window.Theme[1]
        KeyFrame.Parent = ScreenGui

        local KeyTitle = Instance.new("TextLabel")
        KeyTitle.Size = UDim2.new(1, 0, 0, 30)
        KeyTitle.Text = window.KeySettings.Title
        KeyTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
        KeyTitle.Font = Enum.Font.SourceSansBold
        KeyTitle.TextSize = 18
        KeyTitle.Parent = KeyFrame

        local KeyInput = Instance.new("TextBox")
        KeyInput.Size = UDim2.new(0.8, 0, 0, 30)
        KeyInput.Position = UDim2.new(0.1, 0, 0, 80)
        KeyInput.Text = "Enter Key"
        KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
        KeyInput.BackgroundColor3 = window.Theme[2]
        KeyInput.Parent = KeyFrame

        local KeyButton = Instance.new("TextButton")
        KeyButton.Size = UDim2.new(0.4, 0, 0, 30)
        KeyButton.Position = UDim2.new(0.3, 0, 0, 120)
        KeyButton.Text = "Submit"
        KeyButton.BackgroundColor3 = window.Theme[3]
        KeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        KeyButton.Parent = KeyFrame

        KeyButton.MouseButton1Click:Connect(function()
            local inputKey = KeyInput.Text
            for _, key in ipairs(window.KeySettings.Key) do
                if inputKey == key then
                    KeyFrame:Destroy()
                    MainFrame.Visible = true
                    return
                end
            end
            KeyInput.Text = "Invalid Key"
        end)

        MainFrame.Visible = false
    end

    -- Methods
    function window:CreateTab(config)
        local tab = {}
        tab.Name = config.Name or "Tab"
        tab.Icon = config.Icon or "rbxassetid://0"
        tab.ShowTitle = config.ShowTitle or true

        local TabButton = Instance.new("TextButton")
        TabButton.Size = UDim2.new(1, 0, 0, 30)
        TabButton.Text = tab.Name
        TabButton.BackgroundColor3 = window.Theme[2]
        TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        TabButton.Parent = TabContainer

        local TabFrame = Instance.new("Frame")
        TabFrame.Size = UDim2.new(1, 0, 1, 0)
        TabFrame.BackgroundTransparency = 1
        TabFrame.Visible = false
        TabFrame.Parent = ContentArea

        local TabLayout = Instance.new("UIListLayout")
        TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
        TabLayout.Padding = UDim.new(0, 5)
        TabLayout.Parent = TabFrame

        TabButton.MouseButton1Click:Connect(function()
            if window.CurrentTab then
                window.CurrentTab.Visible = false
            end
            TabFrame.Visible = true
            window.CurrentTab = TabFrame
        end)

        function tab:CreateSection(name)
            local section = Instance.new("Frame")
            section.Size = UDim2.new(1, -10, 0, 100)
            section.Position = UDim2.new(0, 5, 0, 0)
            section.BackgroundColor3 = window.Theme[2]
            section.Parent = TabFrame

            local SectionTitle = Instance.new("TextLabel")
            SectionTitle.Size = UDim2.new(1, 0, 0, 20)
            SectionTitle.Text = name or "Section"
            SectionTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
            SectionTitle.Font = Enum.Font.SourceSansBold
            SectionTitle.TextSize = 16
            SectionTitle.Parent = section

            local SectionLayout = Instance.new("UIListLayout")
            SectionLayout.SortOrder = Enum.SortOrder.LayoutOrder
            SectionLayout.Padding = UDim.new(0, 5)
            SectionLayout.Parent = section

            function section:CreateButton(config)
                local button = Instance.new("TextButton")
                button.Size = UDim2.new(1, -10, 0, 30)
                button.Position = UDim2.new(0, 5, 0, 0)
                button.Text = config.Name or "Button"
                button.BackgroundColor3 = window.Theme[3]
                button.TextColor3 = Color3.fromRGB(255, 255, 255)
                button.Parent = section

                button.MouseButton1Click:Connect(function()
                    if config.Callback then
                        config.Callback()
                    end
                end)
            end

            function section:CreateLabel(config)
                local label = Instance.new("TextLabel")
                label.Size = UDim2.new(1, -10, 0, 20)
                label.Position = UDim2.new(0, 5, 0, 0)
                label.Text = config.Text or "Label"
                label.BackgroundTransparency = 1
                label.TextColor3 = Color3.fromRGB(255, 255, 255)
                label.TextSize = 14
                label.Parent = section

                function label:Set(text)
                    label.Text = text
                end

                return label
            end

            return section
        end

        window.Tabs[tab.Name] = TabFrame
        if not window.CurrentTab then
            TabFrame.Visible = true
            window.CurrentTab = TabFrame
        end

        return tab
    end

    function window:Notification(config)
        local notification = Instance.new("Frame")
        notification.Size = UDim2.new(0, 300, 0, 100)
        notification.Position = UDim2.new(1, -310, 1, -110)
        notification.BackgroundColor3 = window.Theme[1]
        notification.Parent = ScreenGui

        local NotificationTitle = Instance.new("TextLabel")
        NotificationTitle.Size = UDim2.new(1, 0, 0, 20)
        NotificationTitle.Text = config.Title or "Notification"
        NotificationTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
        NotificationTitle.Font = Enum.Font.SourceSansBold
        NotificationTitle.TextSize = 16
        NotificationTitle.Parent = notification

        local NotificationContent = Instance.new("TextLabel")
        NotificationContent.Size = UDim2.new(1, -10, 0, 60)
        NotificationContent.Position = UDim2.new(0, 5, 0, 25)
        NotificationContent.Text = config.Content or ""
        NotificationContent.TextColor3 = Color3.fromRGB(255, 255, 255)
        NotificationContent.TextSize = 14
        NotificationContent.TextWrapped = true
        NotificationContent.Parent = notification

        spawn(function()
            wait(config.Duration or 5)
            notification:Destroy()
        end)
    end

    function window:Destroy()
        ScreenGui:Destroy()
    end

    -- Loading Screen
    if window.LoadingEnabled then
        local LoadingFrame = Instance.new("Frame")
        LoadingFrame.Size = UDim2.new(0, 400, 0, 200)
        LoadingFrame.Position = UDim2.new(0.5, -200, 0.5, -100)
        LoadingFrame.BackgroundColor3 = window.Theme[1]
        LoadingFrame.Parent = ScreenGui

        local LoadingTitle = Instance.new("TextLabel")
        LoadingTitle.Size = UDim2.new(1, 0, 0, 30)
        LoadingTitle.Text = window.LoadingTitle
        LoadingTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
        LoadingTitle.Font = Enum.Font.SourceSansBold
        LoadingTitle.TextSize = 20
        LoadingTitle.Parent = LoadingFrame

        local LoadingSubtitle = Instance.new("TextLabel")
        LoadingSubtitle.Size = UDim2.new(1, 0, 0, 20)
        LoadingSubtitle.Position = UDim2.new(0, 0, 0, 30)
        LoadingSubtitle.Text = window.LoadingSubtitle
        LoadingSubtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
        LoadingSubtitle.Font = Enum.Font.SourceSans
        LoadingSubtitle.TextSize = 16
        LoadingSubtitle.Parent = LoadingFrame

        spawn(function()
            wait(2)
            LoadingFrame:Destroy()
            MainFrame.Visible = true
        end)
    end

    return window
end

return NoMoonUI
